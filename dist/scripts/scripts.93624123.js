var convnetjs=convnetjs||{REVISION:"ALPHA"};!function(a){function b(a,b){if(!a){if(b=b||"Assertion failed","undefined"!=typeof Error)throw new Error(b);throw b}}var c=!1,d=0,e=function(){if(c)return c=!1,d;var a=2*Math.random()-1,b=2*Math.random()-1,f=a*a+b*b;if(0==f||f>1)return e();var g=Math.sqrt(-2*Math.log(f)/f);return d=b*g,c=!0,a*g},f=function(a,b){return Math.random()*(b-a)+a},g=function(a,b){return Math.floor(Math.random()*(b-a)+a)},h=function(a,b){return a+e()*b},i=function(a){if("undefined"==typeof a||isNaN(a))return[];if("undefined"==typeof ArrayBuffer){for(var b=new Array(a),c=0;a>c;c++)b[c]=0;return b}return new Float64Array(a)},j=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return!0;return!1},k=function(a){for(var b=[],c=0,d=a.length;d>c;c++)j(b,a[c])||b.push(a[c]);return b},l=function(a){if(0===a.length)return{};for(var b=a[0],c=a[0],d=0,e=0,f=a.length,g=1;f>g;g++)a[g]>b&&(b=a[g],d=g),a[g]<c&&(c=a[g],e=g);return{maxi:d,maxv:b,mini:e,minv:c,dv:b-c}},m=function(a){for(var b,c=a,d=0,e=[],f=0;a>f;f++)e[f]=f;for(;c--;)d=Math.floor(Math.random()*(c+1)),b=e[c],e[c]=e[d],e[d]=b;return e},n=function(a,b){for(var c=f(0,1),d=0,e=0,g=a.length;g>e;e++)if(d+=b[e],d>c)return a[e]},o=function(a,b,c){if("string"==typeof b)return"undefined"!=typeof a[b]?a[b]:c;for(var d=c,e=0;e<b.length;e++){var f=b[e];"undefined"!=typeof a[f]&&(d=a[f])}return d};a.randf=f,a.randi=g,a.randn=h,a.zeros=i,a.maxmin=l,a.randperm=m,a.weightedSample=n,a.arrUnique=k,a.arrContains=j,a.getopt=o,a.assert=b}(convnetjs),function(a){var b=function(b,c,d,e){if("[object Array]"===Object.prototype.toString.call(b)){this.sx=1,this.sy=1,this.depth=b.length,this.w=a.zeros(this.depth),this.dw=a.zeros(this.depth);for(var f=0;f<this.depth;f++)this.w[f]=b[f]}else{this.sx=b,this.sy=c,this.depth=d;var g=b*c*d;if(this.w=a.zeros(g),this.dw=a.zeros(g),"undefined"==typeof e)for(var h=Math.sqrt(1/(b*c*d)),f=0;g>f;f++)this.w[f]=a.randn(0,h);else for(var f=0;g>f;f++)this.w[f]=e}};b.prototype={get:function(a,b,c){var d=(this.sx*b+a)*this.depth+c;return this.w[d]},set:function(a,b,c,d){var e=(this.sx*b+a)*this.depth+c;this.w[e]=d},add:function(a,b,c,d){var e=(this.sx*b+a)*this.depth+c;this.w[e]+=d},get_grad:function(a,b,c){var d=(this.sx*b+a)*this.depth+c;return this.dw[d]},set_grad:function(a,b,c,d){var e=(this.sx*b+a)*this.depth+c;this.dw[e]=d},add_grad:function(a,b,c,d){var e=(this.sx*b+a)*this.depth+c;this.dw[e]+=d},cloneAndZero:function(){return new b(this.sx,this.sy,this.depth,0)},clone:function(){for(var a=new b(this.sx,this.sy,this.depth,0),c=this.w.length,d=0;c>d;d++)a.w[d]=this.w[d];return a},addFrom:function(a){for(var b=0;b<this.w.length;b++)this.w[b]+=a.w[b]},addFromScaled:function(a,b){for(var c=0;c<this.w.length;c++)this.w[c]+=b*a.w[c]},setConst:function(a){for(var b=0;b<this.w.length;b++)this.w[b]=a},toJSON:function(){var a={};return a.sx=this.sx,a.sy=this.sy,a.depth=this.depth,a.w=this.w,a},fromJSON:function(b){this.sx=b.sx,this.sy=b.sy,this.depth=b.depth;var c=this.sx*this.sy*this.depth;this.w=a.zeros(c),this.dw=a.zeros(c);for(var d=0;c>d;d++)this.w[d]=b.w[d]}},a.Vol=b}(convnetjs),function(a){var b=a.Vol,c=function(c,d,e,f,g){if("undefined"==typeof g)var g=!1;if("undefined"==typeof e)var e=a.randi(0,c.sx-d);if("undefined"==typeof f)var f=a.randi(0,c.sy-d);var h;if(d!==c.sx||0!==e||0!==f){h=new b(d,d,c.depth,0);for(var i=0;d>i;i++)for(var j=0;d>j;j++)if(!(0>i+e||i+e>=c.sx||0>j+f||j+f>=c.sy))for(var k=0;k<c.depth;k++)h.set(i,j,k,c.get(i+e,j+f,k))}else h=c;if(g){for(var l=h.cloneAndZero(),i=0;i<h.sx;i++)for(var j=0;j<h.sy;j++)for(var k=0;k<h.depth;k++)l.set(i,j,k,h.get(h.sx-i-1,j,k));h=l}return h},d=function(a,c){if("undefined"==typeof c)var c=!1;var d=document.createElement("canvas");d.width=a.width,d.height=a.height;var e=d.getContext("2d");try{e.drawImage(a,0,0)}catch(f){if("NS_ERROR_NOT_AVAILABLE"===f.name)return!1;throw f}try{var g=e.getImageData(0,0,d.width,d.height)}catch(f){if("IndexSizeError"===f.name)return!1;throw f}for(var h=g.data,i=a.width,j=a.height,k=[],l=0;l<h.length;l++)k.push(h[l]/255-.5);var m=new b(i,j,4,0);if(m.w=k,c){for(var n=new b(i,j,1,0),l=0;i>l;l++)for(var o=0;j>o;o++)n.set(l,o,0,m.get(l,o,0));m=n}return m};a.augment=c,a.img_to_vol=d}(convnetjs),function(a){var b=a.Vol,c=function(a){var a=a||{};this.out_depth=a.filters,this.sx=a.sx,this.in_depth=a.in_depth,this.in_sx=a.in_sx,this.in_sy=a.in_sy,this.sy="undefined"!=typeof a.sy?a.sy:this.sx,this.stride="undefined"!=typeof a.stride?a.stride:1,this.pad="undefined"!=typeof a.pad?a.pad:0,this.l1_decay_mul="undefined"!=typeof a.l1_decay_mul?a.l1_decay_mul:0,this.l2_decay_mul="undefined"!=typeof a.l2_decay_mul?a.l2_decay_mul:1,this.out_sx=Math.floor((this.in_sx+2*this.pad-this.sx)/this.stride+1),this.out_sy=Math.floor((this.in_sy+2*this.pad-this.sy)/this.stride+1),this.layer_type="conv";var c="undefined"!=typeof a.bias_pref?a.bias_pref:0;this.filters=[];for(var d=0;d<this.out_depth;d++)this.filters.push(new b(this.sx,this.sy,this.in_depth));this.biases=new b(1,1,this.out_depth,c)};c.prototype={forward:function(a){this.in_act=a;for(var c=new b(0|this.out_sx,0|this.out_sy,0|this.out_depth,0),d=0|a.sx,e=0|a.sy,f=0|this.stride,g=0;g<this.out_depth;g++)for(var h=this.filters[g],i=0|-this.pad,j=0|-this.pad,k=0;k<this.out_sy;j+=f,k++){i=0|-this.pad;for(var l=0;l<this.out_sx;i+=f,l++){for(var m=0,n=0;n<h.sy;n++)for(var o=j+n,p=0;p<h.sx;p++){var q=i+p;if(o>=0&&e>o&&q>=0&&d>q)for(var r=0;r<h.depth;r++)m+=h.w[(h.sx*n+p)*h.depth+r]*a.w[(d*o+q)*a.depth+r]}m+=this.biases.w[g],c.set(l,k,g,m)}}return this.out_act=c,this.out_act},backward:function(){var b=this.in_act;b.dw=a.zeros(b.w.length);for(var c=0|b.sx,d=0|b.sy,e=0|this.stride,f=0;f<this.out_depth;f++)for(var g=this.filters[f],h=0|-this.pad,i=0|-this.pad,j=0;j<this.out_sy;i+=e,j++){h=0|-this.pad;for(var k=0;k<this.out_sx;h+=e,k++){for(var l=this.out_act.get_grad(k,j,f),m=0;m<g.sy;m++)for(var n=i+m,o=0;o<g.sx;o++){var p=h+o;if(n>=0&&d>n&&p>=0&&c>p)for(var q=0;q<g.depth;q++){var r=(c*n+p)*b.depth+q,s=(g.sx*m+o)*g.depth+q;g.dw[s]+=b.w[r]*l,b.dw[r]+=g.w[s]*l}}this.biases.dw[f]+=l}}},getParamsAndGrads:function(){for(var a=[],b=0;b<this.out_depth;b++)a.push({params:this.filters[b].w,grads:this.filters[b].dw,l2_decay_mul:this.l2_decay_mul,l1_decay_mul:this.l1_decay_mul});return a.push({params:this.biases.w,grads:this.biases.dw,l1_decay_mul:0,l2_decay_mul:0}),a},toJSON:function(){var a={};a.sx=this.sx,a.sy=this.sy,a.stride=this.stride,a.in_depth=this.in_depth,a.out_depth=this.out_depth,a.out_sx=this.out_sx,a.out_sy=this.out_sy,a.layer_type=this.layer_type,a.l1_decay_mul=this.l1_decay_mul,a.l2_decay_mul=this.l2_decay_mul,a.pad=this.pad,a.filters=[];for(var b=0;b<this.filters.length;b++)a.filters.push(this.filters[b].toJSON());return a.biases=this.biases.toJSON(),a},fromJSON:function(a){this.out_depth=a.out_depth,this.out_sx=a.out_sx,this.out_sy=a.out_sy,this.layer_type=a.layer_type,this.sx=a.sx,this.sy=a.sy,this.stride=a.stride,this.in_depth=a.in_depth,this.filters=[],this.l1_decay_mul="undefined"!=typeof a.l1_decay_mul?a.l1_decay_mul:1,this.l2_decay_mul="undefined"!=typeof a.l2_decay_mul?a.l2_decay_mul:1,this.pad="undefined"!=typeof a.pad?a.pad:0;for(var c=0;c<a.filters.length;c++){var d=new b(0,0,0,0);d.fromJSON(a.filters[c]),this.filters.push(d)}this.biases=new b(0,0,0,0),this.biases.fromJSON(a.biases)}};var d=function(a){var a=a||{};this.out_depth="undefined"!=typeof a.num_neurons?a.num_neurons:a.filters,this.l1_decay_mul="undefined"!=typeof a.l1_decay_mul?a.l1_decay_mul:0,this.l2_decay_mul="undefined"!=typeof a.l2_decay_mul?a.l2_decay_mul:1,this.num_inputs=a.in_sx*a.in_sy*a.in_depth,this.out_sx=1,this.out_sy=1,this.layer_type="fc";var c="undefined"!=typeof a.bias_pref?a.bias_pref:0;this.filters=[];for(var d=0;d<this.out_depth;d++)this.filters.push(new b(1,1,this.num_inputs));this.biases=new b(1,1,this.out_depth,c)};d.prototype={forward:function(a){this.in_act=a;for(var c=new b(1,1,this.out_depth,0),d=a.w,e=0;e<this.out_depth;e++){for(var f=0,g=this.filters[e].w,h=0;h<this.num_inputs;h++)f+=d[h]*g[h];f+=this.biases.w[e],c.w[e]=f}return this.out_act=c,this.out_act},backward:function(){var b=this.in_act;b.dw=a.zeros(b.w.length);for(var c=0;c<this.out_depth;c++){for(var d=this.filters[c],e=this.out_act.dw[c],f=0;f<this.num_inputs;f++)b.dw[f]+=d.w[f]*e,d.dw[f]+=b.w[f]*e;this.biases.dw[c]+=e}},getParamsAndGrads:function(){for(var a=[],b=0;b<this.out_depth;b++)a.push({params:this.filters[b].w,grads:this.filters[b].dw,l1_decay_mul:this.l1_decay_mul,l2_decay_mul:this.l2_decay_mul});return a.push({params:this.biases.w,grads:this.biases.dw,l1_decay_mul:0,l2_decay_mul:0}),a},toJSON:function(){var a={};a.out_depth=this.out_depth,a.out_sx=this.out_sx,a.out_sy=this.out_sy,a.layer_type=this.layer_type,a.num_inputs=this.num_inputs,a.l1_decay_mul=this.l1_decay_mul,a.l2_decay_mul=this.l2_decay_mul,a.filters=[];for(var b=0;b<this.filters.length;b++)a.filters.push(this.filters[b].toJSON());return a.biases=this.biases.toJSON(),a},fromJSON:function(a){this.out_depth=a.out_depth,this.out_sx=a.out_sx,this.out_sy=a.out_sy,this.layer_type=a.layer_type,this.num_inputs=a.num_inputs,this.l1_decay_mul="undefined"!=typeof a.l1_decay_mul?a.l1_decay_mul:1,this.l2_decay_mul="undefined"!=typeof a.l2_decay_mul?a.l2_decay_mul:1,this.filters=[];for(var c=0;c<a.filters.length;c++){var d=new b(0,0,0,0);d.fromJSON(a.filters[c]),this.filters.push(d)}this.biases=new b(0,0,0,0),this.biases.fromJSON(a.biases)}},a.ConvLayer=c,a.FullyConnLayer=d}(convnetjs),function(a){var b=a.Vol,c=function(b){var b=b||{};this.sx=b.sx,this.in_depth=b.in_depth,this.in_sx=b.in_sx,this.in_sy=b.in_sy,this.sy="undefined"!=typeof b.sy?b.sy:this.sx,this.stride="undefined"!=typeof b.stride?b.stride:2,this.pad="undefined"!=typeof b.pad?b.pad:0,this.out_depth=this.in_depth,this.out_sx=Math.floor((this.in_sx+2*this.pad-this.sx)/this.stride+1),this.out_sy=Math.floor((this.in_sy+2*this.pad-this.sy)/this.stride+1),this.layer_type="pool",this.switchx=a.zeros(this.out_sx*this.out_sy*this.out_depth),this.switchy=a.zeros(this.out_sx*this.out_sy*this.out_depth)};c.prototype={forward:function(a){this.in_act=a;for(var c=new b(this.out_sx,this.out_sy,this.out_depth,0),d=0,e=0;e<this.out_depth;e++)for(var f=-this.pad,g=-this.pad,h=0;h<this.out_sx;f+=this.stride,h++){g=-this.pad;for(var i=0;i<this.out_sy;g+=this.stride,i++){for(var j=-99999,k=-1,l=-1,m=0;m<this.sx;m++)for(var n=0;n<this.sy;n++){var o=g+n,p=f+m;if(o>=0&&o<a.sy&&p>=0&&p<a.sx){var q=a.get(p,o,e);q>j&&(j=q,k=p,l=o)}}this.switchx[d]=k,this.switchy[d]=l,d++,c.set(h,i,e,j)}}return this.out_act=c,this.out_act},backward:function(){var b=this.in_act;b.dw=a.zeros(b.w.length);for(var c=(this.out_act,0),d=0;d<this.out_depth;d++)for(var e=-this.pad,f=-this.pad,g=0;g<this.out_sx;e+=this.stride,g++){f=-this.pad;for(var h=0;h<this.out_sy;f+=this.stride,h++){var i=this.out_act.get_grad(g,h,d);b.add_grad(this.switchx[c],this.switchy[c],d,i),c++}}},getParamsAndGrads:function(){return[]},toJSON:function(){var a={};return a.sx=this.sx,a.sy=this.sy,a.stride=this.stride,a.in_depth=this.in_depth,a.out_depth=this.out_depth,a.out_sx=this.out_sx,a.out_sy=this.out_sy,a.layer_type=this.layer_type,a.pad=this.pad,a},fromJSON:function(b){this.out_depth=b.out_depth,this.out_sx=b.out_sx,this.out_sy=b.out_sy,this.layer_type=b.layer_type,this.sx=b.sx,this.sy=b.sy,this.stride=b.stride,this.in_depth=b.in_depth,this.pad="undefined"!=typeof b.pad?b.pad:0,this.switchx=a.zeros(this.out_sx*this.out_sy*this.out_depth),this.switchy=a.zeros(this.out_sx*this.out_sy*this.out_depth)}},a.PoolLayer=c}(convnetjs),function(a){var b=(a.Vol,a.getopt),c=function(a){var a=a||{};this.out_depth=b(a,["out_depth","depth"],0),this.out_sx=b(a,["out_sx","sx","width"],1),this.out_sy=b(a,["out_sy","sy","height"],1),this.layer_type="input"};c.prototype={forward:function(a){return this.in_act=a,this.out_act=a,this.out_act},backward:function(){},getParamsAndGrads:function(){return[]},toJSON:function(){var a={};return a.out_depth=this.out_depth,a.out_sx=this.out_sx,a.out_sy=this.out_sy,a.layer_type=this.layer_type,a},fromJSON:function(a){this.out_depth=a.out_depth,this.out_sx=a.out_sx,this.out_sy=a.out_sy,this.layer_type=a.layer_type}},a.InputLayer=c}(convnetjs),function(a){var b=a.Vol,c=function(a){var a=a||{};this.num_inputs=a.in_sx*a.in_sy*a.in_depth,this.out_depth=this.num_inputs,this.out_sx=1,this.out_sy=1,this.layer_type="softmax"};c.prototype={forward:function(c){this.in_act=c;for(var d=new b(1,1,this.out_depth,0),e=c.w,f=c.w[0],g=1;g<this.out_depth;g++)e[g]>f&&(f=e[g]);for(var h=a.zeros(this.out_depth),i=0,g=0;g<this.out_depth;g++){var j=Math.exp(e[g]-f);i+=j,h[g]=j}for(var g=0;g<this.out_depth;g++)h[g]/=i,d.w[g]=h[g];return this.es=h,this.out_act=d,this.out_act},backward:function(b){var c=this.in_act;c.dw=a.zeros(c.w.length);for(var d=0;d<this.out_depth;d++){var e=d===b?1:0,f=-(e-this.es[d]);c.dw[d]=f}return-Math.log(this.es[b])},getParamsAndGrads:function(){return[]},toJSON:function(){var a={};return a.out_depth=this.out_depth,a.out_sx=this.out_sx,a.out_sy=this.out_sy,a.layer_type=this.layer_type,a.num_inputs=this.num_inputs,a},fromJSON:function(a){this.out_depth=a.out_depth,this.out_sx=a.out_sx,this.out_sy=a.out_sy,this.layer_type=a.layer_type,this.num_inputs=a.num_inputs}};var d=function(a){var a=a||{};this.num_inputs=a.in_sx*a.in_sy*a.in_depth,this.out_depth=this.num_inputs,this.out_sx=1,this.out_sy=1,this.layer_type="regression"};d.prototype={forward:function(a){return this.in_act=a,this.out_act=a,a},backward:function(b){var c=this.in_act;c.dw=a.zeros(c.w.length);var d=0;if(b instanceof Array||b instanceof Float64Array)for(var e=0;e<this.out_depth;e++){var f=c.w[e]-b[e];c.dw[e]=f,d+=.5*f*f}else if("number"==typeof b){var f=c.w[0]-b;c.dw[0]=f,d+=.5*f*f}else{var e=b.dim,g=b.val,f=c.w[e]-g;c.dw[e]=f,d+=.5*f*f}return d},getParamsAndGrads:function(){return[]},toJSON:function(){var a={};return a.out_depth=this.out_depth,a.out_sx=this.out_sx,a.out_sy=this.out_sy,a.layer_type=this.layer_type,a.num_inputs=this.num_inputs,a},fromJSON:function(a){this.out_depth=a.out_depth,this.out_sx=a.out_sx,this.out_sy=a.out_sy,this.layer_type=a.layer_type,this.num_inputs=a.num_inputs}};var e=function(a){var a=a||{};this.num_inputs=a.in_sx*a.in_sy*a.in_depth,this.out_depth=this.num_inputs,this.out_sx=1,this.out_sy=1,this.layer_type="svm"};e.prototype={forward:function(a){return this.in_act=a,this.out_act=a,a},backward:function(b){var c=this.in_act;c.dw=a.zeros(c.w.length);for(var d=c.w[b],e=1,f=0,g=0;g<this.out_depth;g++)if(b!==g){var h=-d+c.w[g]+e;h>0&&(c.dw[g]+=1,c.dw[b]-=1,f+=h)}return f},getParamsAndGrads:function(){return[]},toJSON:function(){var a={};return a.out_depth=this.out_depth,a.out_sx=this.out_sx,a.out_sy=this.out_sy,a.layer_type=this.layer_type,a.num_inputs=this.num_inputs,a},fromJSON:function(a){this.out_depth=a.out_depth,this.out_sx=a.out_sx,this.out_sy=a.out_sy,this.layer_type=a.layer_type,this.num_inputs=a.num_inputs}},a.RegressionLayer=d,a.SoftmaxLayer=c,a.SVMLayer=e}(convnetjs),function(a){function b(a){var b=Math.exp(2*a);return(b-1)/(b+1)}var c=a.Vol,d=function(a){var a=a||{};this.out_sx=a.in_sx,this.out_sy=a.in_sy,this.out_depth=a.in_depth,this.layer_type="relu"};d.prototype={forward:function(a){this.in_act=a;for(var b=a.clone(),c=a.w.length,d=b.w,e=0;c>e;e++)d[e]<0&&(d[e]=0);return this.out_act=b,this.out_act},backward:function(){var b=this.in_act,c=this.out_act,d=b.w.length;b.dw=a.zeros(d);for(var e=0;d>e;e++)b.dw[e]=c.w[e]<=0?0:c.dw[e]},getParamsAndGrads:function(){return[]},toJSON:function(){var a={};return a.out_depth=this.out_depth,a.out_sx=this.out_sx,a.out_sy=this.out_sy,a.layer_type=this.layer_type,a},fromJSON:function(a){this.out_depth=a.out_depth,this.out_sx=a.out_sx,this.out_sy=a.out_sy,this.layer_type=a.layer_type}};var e=function(a){var a=a||{};this.out_sx=a.in_sx,this.out_sy=a.in_sy,this.out_depth=a.in_depth,this.layer_type="sigmoid"};e.prototype={forward:function(a){this.in_act=a;for(var b=a.cloneAndZero(),c=a.w.length,d=b.w,e=a.w,f=0;c>f;f++)d[f]=1/(1+Math.exp(-e[f]));return this.out_act=b,this.out_act},backward:function(){var b=this.in_act,c=this.out_act,d=b.w.length;b.dw=a.zeros(d);for(var e=0;d>e;e++){var f=c.w[e];b.dw[e]=f*(1-f)*c.dw[e]}},getParamsAndGrads:function(){return[]},toJSON:function(){var a={};return a.out_depth=this.out_depth,a.out_sx=this.out_sx,a.out_sy=this.out_sy,a.layer_type=this.layer_type,a},fromJSON:function(a){this.out_depth=a.out_depth,this.out_sx=a.out_sx,this.out_sy=a.out_sy,this.layer_type=a.layer_type}};var f=function(b){var b=b||{};this.group_size="undefined"!=typeof b.group_size?b.group_size:2,this.out_sx=b.in_sx,this.out_sy=b.in_sy,this.out_depth=Math.floor(b.in_depth/this.group_size),this.layer_type="maxout",this.switches=a.zeros(this.out_sx*this.out_sy*this.out_depth)};f.prototype={forward:function(a){this.in_act=a;var b=this.out_depth,d=new c(this.out_sx,this.out_sy,this.out_depth,0);if(1===this.out_sx&&1===this.out_sy)for(var e=0;b>e;e++){for(var f=e*this.group_size,g=a.w[f],h=0,i=1;i<this.group_size;i++){var j=a.w[f+i];j>g&&(g=j,h=i)}d.w[e]=g,this.switches[e]=f+h}else for(var k=0,l=0;l<a.sx;l++)for(var m=0;m<a.sy;m++)for(var e=0;b>e;e++){for(var f=e*this.group_size,g=a.get(l,m,f),h=0,i=1;i<this.group_size;i++){var j=a.get(l,m,f+i);j>g&&(g=j,h=i)}d.set(l,m,e,g),this.switches[k]=f+h,k++}return this.out_act=d,this.out_act},backward:function(){var b=this.in_act,c=this.out_act,d=this.out_depth;if(b.dw=a.zeros(b.w.length),1===this.out_sx&&1===this.out_sy)for(var e=0;d>e;e++){var f=c.dw[e];b.dw[this.switches[e]]=f}else for(var g=0,h=0;h<c.sx;h++)for(var i=0;i<c.sy;i++)for(var e=0;d>e;e++){var f=c.get_grad(h,i,e);b.set_grad(h,i,this.switches[g],f),g++}},getParamsAndGrads:function(){return[]},toJSON:function(){var a={};return a.out_depth=this.out_depth,a.out_sx=this.out_sx,a.out_sy=this.out_sy,a.layer_type=this.layer_type,a.group_size=this.group_size,a},fromJSON:function(b){this.out_depth=b.out_depth,this.out_sx=b.out_sx,this.out_sy=b.out_sy,this.layer_type=b.layer_type,this.group_size=b.group_size,this.switches=a.zeros(this.group_size)}};var g=function(a){var a=a||{};this.out_sx=a.in_sx,this.out_sy=a.in_sy,this.out_depth=a.in_depth,this.layer_type="tanh"};g.prototype={forward:function(a){this.in_act=a;for(var c=a.cloneAndZero(),d=a.w.length,e=0;d>e;e++)c.w[e]=b(a.w[e]);return this.out_act=c,this.out_act},backward:function(){var b=this.in_act,c=this.out_act,d=b.w.length;b.dw=a.zeros(d);for(var e=0;d>e;e++){var f=c.w[e];b.dw[e]=(1-f*f)*c.dw[e]}},getParamsAndGrads:function(){return[]},toJSON:function(){var a={};return a.out_depth=this.out_depth,a.out_sx=this.out_sx,a.out_sy=this.out_sy,a.layer_type=this.layer_type,a},fromJSON:function(a){this.out_depth=a.out_depth,this.out_sx=a.out_sx,this.out_sy=a.out_sy,this.layer_type=a.layer_type}},a.TanhLayer=g,a.MaxoutLayer=f,a.ReluLayer=d,a.SigmoidLayer=e}(convnetjs),function(a){var b=(a.Vol,function(b){var b=b||{};this.out_sx=b.in_sx,this.out_sy=b.in_sy,this.out_depth=b.in_depth,this.layer_type="dropout",this.drop_prob="undefined"!=typeof b.drop_prob?b.drop_prob:.5,this.dropped=a.zeros(this.out_sx*this.out_sy*this.out_depth)});b.prototype={forward:function(a,b){this.in_act=a,"undefined"==typeof b&&(b=!1);var c=a.clone(),d=a.w.length;if(b)for(var e=0;d>e;e++)Math.random()<this.drop_prob?(c.w[e]=0,this.dropped[e]=!0):this.dropped[e]=!1;else for(var e=0;d>e;e++)c.w[e]*=this.drop_prob;return this.out_act=c,this.out_act},backward:function(){var b=this.in_act,c=this.out_act,d=b.w.length;b.dw=a.zeros(d);for(var e=0;d>e;e++)this.dropped[e]||(b.dw[e]=c.dw[e])},getParamsAndGrads:function(){return[]},toJSON:function(){var a={};return a.out_depth=this.out_depth,a.out_sx=this.out_sx,a.out_sy=this.out_sy,a.layer_type=this.layer_type,a.drop_prob=this.drop_prob,a},fromJSON:function(a){this.out_depth=a.out_depth,this.out_sx=a.out_sx,this.out_sy=a.out_sy,this.layer_type=a.layer_type,this.drop_prob=a.drop_prob}},a.DropoutLayer=b}(convnetjs),function(a){var b=(a.Vol,function(a){var a=a||{};this.k=a.k,this.n=a.n,this.alpha=a.alpha,this.beta=a.beta,this.out_sx=a.in_sx,this.out_sy=a.in_sy,this.out_depth=a.in_depth,this.layer_type="lrn",this.n%2===0&&console.log("WARNING n should be odd for LRN layer")});b.prototype={forward:function(a){this.in_act=a;var b=a.cloneAndZero();this.S_cache_=a.cloneAndZero();for(var c=Math.floor(this.n/2),d=0;d<a.sx;d++)for(var e=0;e<a.sy;e++)for(var f=0;f<a.depth;f++){for(var g=a.get(d,e,f),h=0,i=Math.max(0,f-c);i<=Math.min(f+c,a.depth-1);i++){var j=a.get(d,e,i);h+=j*j}h*=this.alpha/this.n,h+=this.k,this.S_cache_.set(d,e,f,h),h=Math.pow(h,this.beta),b.set(d,e,f,g/h)}return this.out_act=b,this.out_act},backward:function(){var b=this.in_act;b.dw=a.zeros(b.w.length);for(var c=(this.out_act,Math.floor(this.n/2)),d=0;d<b.sx;d++)for(var e=0;e<b.sy;e++)for(var f=0;f<b.depth;f++)for(var g=this.out_act.get_grad(d,e,f),h=this.S_cache_.get(d,e,f),i=Math.pow(h,this.beta),j=i*i,k=Math.max(0,f-c);k<=Math.min(f+c,b.depth-1);k++){var l=b.get(d,e,k),m=-l*this.beta*Math.pow(h,this.beta-1)*this.alpha/this.n*2*l;k===f&&(m+=i),m/=j,m*=g,b.add_grad(d,e,k,m)}},getParamsAndGrads:function(){return[]},toJSON:function(){var a={};return a.k=this.k,a.n=this.n,a.alpha=this.alpha,a.beta=this.beta,a.out_sx=this.out_sx,a.out_sy=this.out_sy,a.out_depth=this.out_depth,a.layer_type=this.layer_type,a},fromJSON:function(a){this.k=a.k,this.n=a.n,this.alpha=a.alpha,this.beta=a.beta,this.out_sx=a.out_sx,this.out_sy=a.out_sy,this.out_depth=a.out_depth,this.layer_type=a.layer_type}},a.LocalResponseNormalizationLayer=b}(convnetjs),function(a){var b=(a.Vol,a.assert),c=function(){this.layers=[]};c.prototype={makeLayers:function(c){b(c.length>=2,"Error! At least one input layer and one loss layer are required."),b("input"===c[0].type,"Error! First layer must be the input layer, to declare size of inputs");var d=function(){for(var a=[],b=0;b<c.length;b++){var d=c[b];if(("softmax"===d.type||"svm"===d.type)&&a.push({type:"fc",num_neurons:d.num_classes}),"regression"===d.type&&a.push({type:"fc",num_neurons:d.num_neurons}),"fc"!==d.type&&"conv"!==d.type||"undefined"!=typeof d.bias_pref||(d.bias_pref=0,"undefined"!=typeof d.activation&&"relu"===d.activation&&(d.bias_pref=.1)),a.push(d),"undefined"!=typeof d.activation)if("relu"===d.activation)a.push({type:"relu"});else if("sigmoid"===d.activation)a.push({type:"sigmoid"});else if("tanh"===d.activation)a.push({type:"tanh"});else if("maxout"===d.activation){var e="undefined"!==d.group_size?d.group_size:2;a.push({type:"maxout",group_size:e})}else console.log("ERROR unsupported activation "+d.activation);"undefined"!=typeof d.drop_prob&&"dropout"!==d.type&&a.push({type:"dropout",drop_prob:d.drop_prob})}return a};c=d(c),this.layers=[];for(var e=0;e<c.length;e++){var f=c[e];if(e>0){var g=this.layers[e-1];f.in_sx=g.out_sx,f.in_sy=g.out_sy,f.in_depth=g.out_depth}switch(f.type){case"fc":this.layers.push(new a.FullyConnLayer(f));break;case"lrn":this.layers.push(new a.LocalResponseNormalizationLayer(f));break;case"dropout":this.layers.push(new a.DropoutLayer(f));break;case"input":this.layers.push(new a.InputLayer(f));break;case"softmax":this.layers.push(new a.SoftmaxLayer(f));break;case"regression":this.layers.push(new a.RegressionLayer(f));break;case"conv":this.layers.push(new a.ConvLayer(f));break;case"pool":this.layers.push(new a.PoolLayer(f));break;case"relu":this.layers.push(new a.ReluLayer(f));break;case"sigmoid":this.layers.push(new a.SigmoidLayer(f));break;case"tanh":this.layers.push(new a.TanhLayer(f));break;case"maxout":this.layers.push(new a.MaxoutLayer(f));break;case"svm":this.layers.push(new a.SVMLayer(f));break;default:console.log("ERROR: UNRECOGNIZED LAYER TYPE: "+f.type)}}},forward:function(a,b){"undefined"==typeof b&&(b=!1);for(var c=this.layers[0].forward(a,b),d=1;d<this.layers.length;d++)c=this.layers[d].forward(c,b);return c},getCostLoss:function(a,b){this.forward(a,!1);var c=this.layers.length,d=this.layers[c-1].backward(b);return d},backward:function(a){for(var b=this.layers.length,c=this.layers[b-1].backward(a),d=b-2;d>=0;d--)this.layers[d].backward();return c},getParamsAndGrads:function(){for(var a=[],b=0;b<this.layers.length;b++)for(var c=this.layers[b].getParamsAndGrads(),d=0;d<c.length;d++)a.push(c[d]);return a},getPrediction:function(){var a=this.layers[this.layers.length-1];b("softmax"===a.layer_type,"getPrediction function assumes softmax as last layer of the net!");for(var c=a.out_act.w,d=c[0],e=0,f=1;f<c.length;f++)c[f]>d&&(d=c[f],e=f);return e},toJSON:function(){var a={};a.layers=[];for(var b=0;b<this.layers.length;b++)a.layers.push(this.layers[b].toJSON());return a},fromJSON:function(b){this.layers=[];for(var c=0;c<b.layers.length;c++){var d,e=b.layers[c],f=e.layer_type;"input"===f&&(d=new a.InputLayer),"relu"===f&&(d=new a.ReluLayer),"sigmoid"===f&&(d=new a.SigmoidLayer),"tanh"===f&&(d=new a.TanhLayer),"dropout"===f&&(d=new a.DropoutLayer),"conv"===f&&(d=new a.ConvLayer),"pool"===f&&(d=new a.PoolLayer),"lrn"===f&&(d=new a.LocalResponseNormalizationLayer),"softmax"===f&&(d=new a.SoftmaxLayer),"regression"===f&&(d=new a.RegressionLayer),"fc"===f&&(d=new a.FullyConnLayer),"maxout"===f&&(d=new a.MaxoutLayer),"svm"===f&&(d=new a.SVMLayer),d.fromJSON(e),this.layers.push(d)}}},a.Net=c}(convnetjs),function(a){var b=(a.Vol,function(a,b){this.net=a;var b=b||{};this.learning_rate="undefined"!=typeof b.learning_rate?b.learning_rate:.01,this.l1_decay="undefined"!=typeof b.l1_decay?b.l1_decay:0,this.l2_decay="undefined"!=typeof b.l2_decay?b.l2_decay:0,this.batch_size="undefined"!=typeof b.batch_size?b.batch_size:1,this.method="undefined"!=typeof b.method?b.method:"sgd",this.momentum="undefined"!=typeof b.momentum?b.momentum:.9,this.ro="undefined"!=typeof b.ro?b.ro:.95,this.eps="undefined"!=typeof b.eps?b.eps:1e-6,this.k=0,this.gsum=[],this.xsum=[]});b.prototype={train:function(b,c){var d=(new Date).getTime();this.net.forward(b,!0);var e=(new Date).getTime(),f=e-d,d=(new Date).getTime(),g=this.net.backward(c),h=0,i=0,e=(new Date).getTime(),j=e-d;if(this.k++,this.k%this.batch_size===0){var k=this.net.getParamsAndGrads();if(0===this.gsum.length&&("sgd"!==this.method||this.momentum>0))for(var l=0;l<k.length;l++)this.gsum.push(a.zeros(k[l].params.length)),this.xsum.push("adadelta"===this.method?a.zeros(k[l].params.length):[]);for(var l=0;l<k.length;l++)for(var m=k[l],n=m.params,o=m.grads,p="undefined"!=typeof m.l2_decay_mul?m.l2_decay_mul:1,q="undefined"!=typeof m.l1_decay_mul?m.l1_decay_mul:1,r=this.l2_decay*p,s=this.l1_decay*q,t=n.length,u=0;t>u;u++){h+=r*n[u]*n[u]/2,i+=s*Math.abs(n[u]);var v=s*(n[u]>0?1:-1),w=r*n[u],x=(w+v+o[u])/this.batch_size,y=this.gsum[l],z=this.xsum[l];if("adagrad"===this.method){y[u]=y[u]+x*x;var A=-this.learning_rate/Math.sqrt(y[u]+this.eps)*x;n[u]+=A}else if("windowgrad"===this.method){y[u]=this.ro*y[u]+(1-this.ro)*x*x;var A=-this.learning_rate/Math.sqrt(y[u]+this.eps)*x;n[u]+=A}else if("adadelta"===this.method){y[u]=this.ro*y[u]+(1-this.ro)*x*x;var A=-Math.sqrt((z[u]+this.eps)/(y[u]+this.eps))*x;z[u]=this.ro*z[u]+(1-this.ro)*A*A,n[u]+=A}else if("nesterov"===this.method){var A=y[u];y[u]=y[u]*this.momentum+this.learning_rate*x,A=this.momentum*A-(1+this.momentum)*y[u],n[u]+=A}else if(this.momentum>0){var A=this.momentum*y[u]-this.learning_rate*x;y[u]=A,n[u]+=A}else n[u]+=-this.learning_rate*x;o[u]=0}}return{fwd_time:f,bwd_time:j,l2_decay_loss:h,l1_decay_loss:i,cost_loss:g,softmax_loss:g,loss:g+i+h}}},a.Trainer=b,a.SGDTrainer=b}(convnetjs),function(a){var b=a.randf,c=a.randi,d=a.Net,e=a.Trainer,f=a.maxmin,g=a.randperm,h=a.weightedSample,i=a.getopt,j=a.arrUnique,k=function(a,b,c){var c=c||{};"undefined"==typeof a&&(a=[]),"undefined"==typeof b&&(b=[]),this.data=a,this.labels=b,this.train_ratio=i(c,"train_ratio",.7),this.num_folds=i(c,"num_folds",10),this.num_candidates=i(c,"num_candidates",50),this.num_epochs=i(c,"num_epochs",50),this.ensemble_size=i(c,"ensemble_size",10),this.batch_size_min=i(c,"batch_size_min",10),this.batch_size_max=i(c,"batch_size_max",300),this.l2_decay_min=i(c,"l2_decay_min",-4),this.l2_decay_max=i(c,"l2_decay_max",2),this.learning_rate_min=i(c,"learning_rate_min",-4),this.learning_rate_max=i(c,"learning_rate_max",0),this.momentum_min=i(c,"momentum_min",.9),this.momentum_max=i(c,"momentum_max",.9),this.neurons_min=i(c,"neurons_min",5),this.neurons_max=i(c,"neurons_max",30),this.folds=[],this.candidates=[],this.evaluated_candidates=[],this.unique_labels=j(b),this.iter=0,this.foldix=0,this.finish_fold_callback=null,this.finish_batch_callback=null,this.data.length>0&&(this.sampleFolds(),this.sampleCandidates())};k.prototype={sampleFolds:function(){var a=this.data.length,b=Math.floor(this.train_ratio*a);this.folds=[];for(var c=0;c<this.num_folds;c++){var d=g(a);this.folds.push({train_ix:d.slice(0,b),test_ix:d.slice(b,a)})}},sampleCandidate:function(){var a=this.data[0].w.length,f=this.unique_labels.length,g=[];g.push({type:"input",out_sx:1,out_sy:1,out_depth:a});for(var i=h([0,1,2,3],[.2,.3,.3,.2]),j=0;i>j;j++){var k=c(this.neurons_min,this.neurons_max),l=["tanh","maxout","relu"][c(0,3)];if(b(0,1)<.5){var m=Math.random();g.push({type:"fc",num_neurons:k,activation:l,drop_prob:m})}else g.push({type:"fc",num_neurons:k,activation:l})}g.push({type:"softmax",num_classes:f});var n=new d;n.makeLayers(g);var o,p=c(this.batch_size_min,this.batch_size_max),q=Math.pow(10,b(this.l2_decay_min,this.l2_decay_max)),r=Math.pow(10,b(this.learning_rate_min,this.learning_rate_max)),s=b(this.momentum_min,this.momentum_max),t=b(0,1);o=.33>t?{method:"adadelta",batch_size:p,l2_decay:q}:.66>t?{method:"adagrad",learning_rate:r,batch_size:p,l2_decay:q}:{method:"sgd",learning_rate:r,momentum:s,batch_size:p,l2_decay:q};var u=new e(n,o),v={};return v.acc=[],v.accv=0,v.layer_defs=g,v.trainer_def=o,v.net=n,v.trainer=u,v},sampleCandidates:function(){this.candidates=[];for(var a=0;a<this.num_candidates;a++){var b=this.sampleCandidate();this.candidates.push(b)}},step:function(){this.iter++;for(var a=this.folds[this.foldix],b=a.train_ix[c(0,a.train_ix.length)],f=0;f<this.candidates.length;f++){var g=this.data[b],h=this.labels[b];this.candidates[f].trainer.train(g,h)}var i=this.num_epochs*a.train_ix.length;if(this.iter>=i){for(var j=this.evalValErrors(),f=0;f<this.candidates.length;f++){var k=this.candidates[f];k.acc.push(j[f]),k.accv+=j[f]}if(this.iter=0,this.foldix++,null!==this.finish_fold_callback&&this.finish_fold_callback(),this.foldix>=this.folds.length){for(var f=0;f<this.candidates.length;f++)this.evaluated_candidates.push(this.candidates[f]);this.evaluated_candidates.sort(function(a,b){return a.accv/a.acc.length>b.accv/b.acc.length?-1:1}),this.evaluated_candidates.length>3*this.ensemble_size&&(this.evaluated_candidates=this.evaluated_candidates.slice(0,3*this.ensemble_size)),null!==this.finish_batch_callback&&this.finish_batch_callback(),this.sampleCandidates(),this.foldix=0}else for(var f=0;f<this.candidates.length;f++){var k=this.candidates[f],l=new d;l.makeLayers(k.layer_defs);var m=new e(l,k.trainer_def);k.net=l,k.trainer=m}}},evalValErrors:function(){for(var a=[],b=this.folds[this.foldix],c=0;c<this.candidates.length;c++){for(var d=this.candidates[c].net,e=0,f=0;f<b.test_ix.length;f++){var g=this.data[b.test_ix[f]],h=this.labels[b.test_ix[f]];d.forward(g);var i=d.getPrediction();e+=i===h?1:0}e/=b.test_ix.length,a.push(e)}return a},predict_soft:function(a){var b=[],c=0;0===this.evaluated_candidates.length?(c=this.candidates.length,b=this.candidates):(c=Math.min(this.ensemble_size,this.evaluated_candidates.length),b=this.evaluated_candidates);for(var d,e,f=0;c>f;f++){var g=b[f].net,h=g.forward(a);if(0===f)d=h,e=h.w.length;else for(var i=0;e>i;i++)d.w[i]+=h.w[i]}for(var i=0;e>i;i++)d.w[i]/=c;return d},predict:function(a){var b=this.predict_soft(a);if(0!==b.w.length)var c=f(b.w),d=c.maxi;else var d=-1;return d},toJSON:function(){var a=Math.min(this.ensemble_size,this.evaluated_candidates.length),b={};b.nets=[];for(var c=0;a>c;c++)b.nets.push(this.evaluated_candidates[c].net.toJSON());return b},fromJSON:function(a){this.ensemble_size=a.nets.length,this.evaluated_candidates=[];
for(var b=0;b<this.ensemble_size;b++){var c=new d;c.fromJSON(a.nets[b]);var e={};e.net=c,this.evaluated_candidates.push(e)}},onFinishFold:function(a){this.finish_fold_callback=a},onFinishBatch:function(a){this.finish_batch_callback=a}},a.MagicNet=k}(convnetjs),function(a){"undefined"==typeof module||"undefined"==typeof module.exports?window.jsfeat=a:module.exports=a}(convnetjs),angular.module("visualApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/journal",{templateUrl:"views/journal.html",controller:"JournalCtrl"}).when("/visualizations",{templateUrl:"views/visualizations.html",controller:"VisualizationsCtrl"}).when("/rebalance",{templateUrl:"views/rebalance.html",controller:"RebalanceCtrl"}).when("/redblack",{templateUrl:"views/redblack.html",controller:"RedblackCtrl"}).when("/neural",{templateUrl:"views/neural.html",controller:"NeuralCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("visualApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("visualApp").controller("JournalCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("visualApp").controller("VisualizationsCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("visualApp").controller("RebalanceCtrl",["$scope","BinaryTreeService",function(a,b){a.addNode=function(){if(c&&a.addNodeValue){var b=parseInt(a.addNodeValue);c.addNewNodeWithAnimation(b),a.addNodeValue=""}},a.findNode=function(){if(c&&a.findNodeValue){var b=parseInt(a.findNodeValue);c.findNode(b)}a.findNodeValue=""},a.removeNode=function(){if(c&&a.removeNodeValue){var b=parseInt(a.removeNodeValue);c.removeNode(b)}a.removeNodeValue=""};var c=b.getBinaryTree()}]),angular.module("visualApp").controller("RedblackCtrl",["$scope","RedBlackTreeService",function(a,b){a.addNode=function(){if(c&&a.addNodeValue){var b=parseInt(a.addNodeValue);c.addNewNodeWithAnimation(b),a.addNodeValue=""}},a.findNode=function(){if(c&&a.findNodeValue){var b=parseInt(a.findNodeValue);c.findNodeWithAnimation(b)}a.findNodeValue=""},a.removeNode=function(){if(c&&a.removeNodeValue){var b=parseInt(a.removeNodeValue);c.removeNode(b)}a.removeNodeValue=""};var c=b.getRedBlackTree()}]),angular.module("visualApp").service("BinaryTreeService",function(){function a(){var a=1e3,b=d3.select(".svg-container").node().getBoundingClientRect().width,c=460,d=12,e={cx:Math.floor(b/2),cy:30,w:60,h:60};e.root={id:0,value:0,position:{x:e.cx,y:e.cy},parent:void 0},e.size=1,e.findNodeWithAnimation=function(b){function c(b,d,e){return b.value==d?(n(b.id,"#79D667",e),e+=a):d<=b.value&&b.left?(n(b.id,"#BCE0FF",e),e=c(b.left,d,e+a)):d>b.value&&b.right?(n(b.id,"#BCE0FF",e),e=c(b.right,d,e+a)):(n(b.id,"#D76C79",e),e+=a),e}return c(e.root,b,0)},e.addNewNode=function(a){var b=f(a);h(b),l(),m()},e.addNewNodeWithAnimation=function(b){var c=f(b);h(c),l();var d=e.findNodeWithAnimation(b);setTimeout(function(){m()},d-a)};var f=function(a){var b=e.size++;return{id:b,value:a,position:{},parent:void 0,color:1}},g=function(a){function b(a,c){return a.value==c?a:c<=a.value&&a.left?b(a.left,c):c>a.value&&a.right?b(a.right,c):void 0}return b(e.root,a)};e.removeNode=function(a){function b(a){return a.right?a.right:a}function c(a){if(a.left&&a.right){var d=b(a.left);a.value=d.value,c(d)}else{var f=a.left?a.left:a.right;a==e.root?e.root=f:a==a.parent.left?(a.parent.left=f,f&&(f.parent=a.parent)):(a.parent.right=f,f&&(f.parent=a.parent))}}var d=e.findNodeWithAnimation(a),f=g(a);setTimeout(function(){f&&(c(f),l(),m())},d)};var h=function(a){function b(b){void 0!=a.value&&(a.value<=b.value?c(b,a):d(b,a))}function c(a,c){a.left?b(a.left):(a.left=c,c.parent=a)}function d(a,c){a.right?b(a.right):(a.right=c,c.parent=a)}e.root?b(e.root):(a.position={x:e.cx,y:e.cy},e.root=a)},i=function(a){var b=0;return a.left||a.right?(a.left&&(b+=i(a.left)),a.right&&(b+=i(a.right))):b=1,b},j=function(){function a(c,d){if(c){var e={id:c.id,value:c.value,position:c.position,parent:d};b.push(e);var f={id:c.id,position:c.position};a(c.left,f),a(c.right,f)}}var b=[];e.root&&a(e.root,{position:{x:e.cx,y:e.cy}});var c=b.sort(function(a,b){return a.id-b.id});return c},k=function(){function a(c){function d(d){d&&(b.push({parentId:c.id,parentPosition:c.position,childId:d.id,childPosition:d.position}),a(d))}d(c.left),d(c.right)}var b=[];return e.root&&a(e.root),b.sort(function(a,b){return a.childId-b.childId})},l=function(){function a(b,c,d){if(b){var f=e.w*i(b);d+=f,b.position={x:d-(f+e.w)/2,y:c.position.y+e.h};var g=i(b),h=b.position.x-e.w*(g-1)/2;h=a(b.left,b,h),h=a(b.right,b,h)}return d}if(e.root){var b=e.root;b.position={x:e.cx,y:e.cy};var c=i(b),d=b.position.x-e.w*(c-1)/2;d=a(b.left,b,d),d=a(b.right,b,d)}},m=function(){var a=d3.select("#g_lines").selectAll("line").data(k(),function(a){return a.childId});console.log(a),a.transition().duration(500).attr("x1",function(a){return a.parentPosition.x}).attr("y1",function(a){return a.parentPosition.y}).attr("x2",function(a){return a.childPosition.x}).attr("y2",function(a){return a.childPosition.y}),a.enter().append("line").attr("x1",function(a){return a.parentPosition.x}).attr("y1",function(a){return a.parentPosition.y}).attr("x2",function(a){return a.parentPosition.x}).attr("y2",function(a){return a.parentPosition.y}).transition().duration(500).attr("x2",function(a){return a.childPosition.x}).attr("y2",function(a){return a.childPosition.y}),a.exit().remove();var b=d3.select("#g_circles").selectAll("circle").data(j(),function(a){return a.id});b.transition().duration(500).attr("cx",function(a){return a.position.x}).attr("cy",function(a){return a.position.y}),b.enter().append("circle").attr("id",function(a){return"name"+a.id}).attr("cx",function(a){return a.parent.position.x}).attr("cy",function(a){return a.parent.position.y}).attr("r",d).transition().duration(500).attr("cx",function(a){return a.position.x}).attr("cy",function(a){return a.position.y}),b.exit().remove();var c=d3.select("#g_labels").selectAll("text").data(j(),function(a){return a.id});c.text(function(a){return a.value.toString()}).transition().duration(500).attr("x",function(a){return a.position.x}).attr("y",function(a){return a.position.y+5}),c.enter().append("text").attr("x",function(a){return a.parent.position.x}).attr("y",function(a){return a.parent.position.y+5}).text(function(a){return a.value.toString()}).transition().duration(500).attr("x",function(a){return a.position.x}).attr("y",function(a){return a.position.y+5}),c.exit().remove()},n=function(b,c,d){var e=d3.select("#g_circles").select("#name"+b),f=d+a;return e.transition().delay(d).style("fill",c).transition().duration(a-500).delay(f-500).style("fill","white"),f},o=function(){d3.select(".svg-container").append("svg").attr("width",b).attr("height",c).attr("id","treesvg");var a=d3.select("#treesvg").append("g").attr("id","g_lines").selectAll("line").data(k(),function(a){return a.childId});a.enter().append("line").attr("x1",function(a){return a.parentPosition.x}).attr("y1",function(a){return a.parentPosition.y}).attr("x2",function(a){return a.childPosition.x}).attr("y2",function(a){return a.childPosition.y});var f=d3.select("#treesvg").append("g").attr("id","g_circles").selectAll("circle").data(j(),function(a){return a.id});f.enter().append("circle").attr("id",function(a){return"name"+a.id}).attr("cx",function(a){return a.position.x}).attr("cy",function(a){return a.position.y}).attr("r",d);var g=d3.select("#treesvg").append("g").attr("id","g_labels").selectAll("text").data(j(),function(a){return a.id});g.enter().append("text").attr("x",function(a){return a.position.x}).attr("y",function(a){return a.position.y+5}).text(function(a){return a.value.toString()}),e.addNewNode(7)};return o(),e}this.getBinaryTree=function(){return a()}}),angular.module("visualApp").service("RedBlackTreeService",function(){function a(){var a=1e3,b=d3.select(".svg-container").node().getBoundingClientRect().width,c=460,d=12,e={cx:Math.floor(b/2),cy:30,w:60,h:60};e.root={id:0,value:8,labeltext:"8",position:{x:e.cx,y:e.cy},parent:void 0,color:1},e.size=1,e.findNodeWithAnimation=function(b){function c(b,d,e){return b.value==d?(u(b.id,"#00C782",e),e+=a):d<=b.value&&!b.left.isLeaf?(u(b.id,"#00A9C7",e),e=c(b.left,d,e+a)):d>b.value&&!b.right.isLeaf?(u(b.id,"#00A9C7",e),e=c(b.right,d,e+a)):(u(b.id,"#F02400",e),e+=a),e}return c(e.root,b,0)},e.addNewNode=function(a){{var b=f(a);i(b)}k(b),s(),t()},e.addNewNodeWithAnimation=function(b){var c=f(b);i(c);var d=e.findNodeWithAnimation(c.value)-a;setTimeout(function(){s(),t(),k(c),setTimeout(function(){s(),t()},a)},d)};var f=function(a){var b=e.size++,c={id:b,value:a,labeltext:a.toString(),position:{},left:g(),right:g(),parent:void 0,color:1};return c.left.parent=c,c.right.parent=c,c},g=function(){var a=e.size++;return{id:a,position:{},parent:void 0,color:0,isLeaf:!0}},h=function(a){function b(a,c){return a.value==c?a:c<=a.value&&a.left?b(a.left,c):c>a.value&&a.right?b(a.right,c):void 0}return b(e.root,a)};e.removeNode=function(b){function c(a){return a.right.isLeaf?a:a.right}function d(b){if(b.left.isLeaf||b.right.isLeaf){var f=b.right.isLeaf?b.left:b.right;return b==e.root?e.root=void 0:b==b.parent.left?(b.parent.left=f,f&&(f.parent=b.parent)):(b.parent.right=f,f&&(f.parent=b.parent)),0==b.color&&(1==f.color?f.color=0:j(f)),0}var g=c(b.left),h=b.value,i=b.labeltext,k=b.id;return b.value=g.value,b.labeltext=g.labeltext,b.id=g.id,g.value=h,g.labeltext=i,g.id=k,t(),d(g),a}var f=h(b),g=e.findNodeWithAnimation(b);setTimeout(function(){if(f){var a=d(f);s(),setTimeout(function(){t()},a)}},g)};var i=function(a){function b(b){void 0!=a.value&&(a.value<=b.value?c(b,a):d(b,a))}function c(a,c){a.left.isLeaf?(a.left=c,c.parent=a):b(a.left)}function d(a,c){a.right.isLeaf?(a.right=c,c.parent=a):b(a.right)}e.root?b(e.root):(a.position={x:e.cx,y:e.cy},e.root=a)},j=function(a){function b(a){return a==a.parent.left?a.parent.right:a.parent.left}function c(a){a!=e.root&&d(a)}function d(a){var c=b(a);1==c.color&&(a.parent.color=1,c.color=0,a==a.parent.left?m(a.parent):l(a.parent)),f(a)}function f(a){var d=b(a);0==a.parent.color&&0==d.color&&0==d.left.color&&0==d.right.color?(d.color=1,c(a.parent)):g(a)}function g(a){var c=b(a);1==a.parent.color&&0==c.color&&0==c.left.color&&0==c.right.color?(c.color=1,a.parent.color=0):h(a)}function h(a){var c=b(a);0==c.color&&(a==a.parent.left&&0==c.right.color&&1==c.left.color?(c.color=1,c.left.color=0,l(c)):a==a.parent.right&&0==c.left.color&&1==c.right.color&&(c.color=1,c.right.color=0,m(c))),i(a)}function i(a){var c=b(a);c.color=a.parent.color,a.parent.color=0,a==a.parent.left?(c.right.color=0,m(a.parent)):(c.left.color=0,l(a.parent))}e.root&&c(a)},k=function(a){function b(a){a==e.root?a.color=0:c(a)}function c(a){0!=a.parent.color&&d(a)}function d(a){var c=o(a);if(c&&1==c.color){a.parent.color=0,c.color=0;var d=n(a);d.color=1,b(d)}else f(a)}function f(a){var b=n(a);a==a.parent.right&&a.parent==b.left?(m(a.parent),a=a.left):a==a.parent.left&&a.parent==b.right&&(l(a.parent),a=a.right),g(a)}function g(a){var b=n(a);a.parent.color=0,b.color=1,a==a.parent.left?l(b):m(b)}b(a)},l=function(a){var b=a.parent,c=a.left;a.left=c.right,a.left.parent=a,c.right=a,c.right.parent=c,c.parent=b,b?b.left==a?b.left=c:b.right=c:e.root=c},m=function(a){var b=a.parent,c=a.right;a.right=c.left,a.right.parent=a,c.left=a,c.left.parent=c,c.parent=b,b?b.right==a?b.right=c:b.left=c:e.root=c},n=function(a){return a.parent&&a.parent.parent?a.parent.parent:void 0},o=function(a){var b=n(a);return b?a.parent==b.left?b.right:b.left:void 0},p=function(a){if(!a)return 0;var b=0;return a.isLeaf?b=1:(b+=p(a.left),b+=p(a.right)),b},q=function(){function a(c,d){var e={id:c.id,labeltext:c.labeltext,position:c.position,parent:d,color:c.color};b.push(e);var f={id:c.id,position:c.position};c.isLeaf||(a(c.left,f),a(c.right,f))}var b=[];e.root&&a(e.root,{position:{x:e.cx,y:e.cy}});var c=b.sort(function(a,b){return a.id-b.id});return c},r=function(){function a(a){a.isLeaf||(b(a.left,a),b(a.right,a))}function b(b,d){c.push({parentId:d.id,parentLabel:d.labeltext,parentPosition:d.position,childId:b.id,childLabel:b.labeltext,childPosition:b.position}),a(b)}var c=[];return e.root&&a(e.root),c.sort(function(a,b){return a.childId-b.childId})},s=function(){function a(b,c,d){var f=e.w*p(b);d+=f,b.position={x:d-(f+e.w)/2,y:c.position.y+e.h};var g=p(b),h=b.position.x-e.w*(g-1)/2;return b.isLeaf||(h=a(b.left,b,h),h=a(b.right,b,h)),d}if(e.root){var b=e.root;b.position={x:e.cx,y:e.cy};var c=p(b),d=b.position.x-e.w*(c-1)/2;d=a(b.left,b,d),a(b.right,b,d)}},t=function(){var a=d3.select("#g_lines").selectAll("line").data(r(),function(a){return a.childId});a.transition().duration(500).attr("x1",function(a){return a.parentPosition.x}).attr("y1",function(a){return a.parentPosition.y}).attr("x2",function(a){return a.childPosition.x}).attr("y2",function(a){return a.childPosition.y}),a.enter().append("line").attr("x1",function(a){return a.parentPosition.x}).attr("y1",function(a){return a.parentPosition.y}).attr("x2",function(a){return a.parentPosition.x}).attr("y2",function(a){return a.parentPosition.y}).transition().duration(500).attr("x2",function(a){return a.childPosition.x}).attr("y2",function(a){return a.childPosition.y}),a.exit().remove();var b=d3.select("#g_circles").selectAll("circle").data(q(),function(a){return a.id});b.transition().duration(500).attr("cx",function(a){return a.position.x}).attr("cy",function(a){return a.position.y}),b.enter().append("circle").attr("id",function(a){return"name"+a.id}).attr("cx",function(a){return a.parent.position.x}).attr("cy",function(a){return a.parent.position.y}).attr("r",d).transition().duration(500).attr("cx",function(a){return a.position.x}).attr("cy",function(a){return a.position.y}),b.exit().remove(),b=d3.select("#g_circles").selectAll("circle").data(q(),function(a){return a.id}),b.style("fill",function(a){return 0==a.color?"#A9A9A9":"#FF745c"});var c=d3.select("#g_labels").selectAll("text").data(q(),function(a){return a.id});c.text(function(a){return a.labeltext}).transition().duration(500).attr("x",function(a){return a.position.x}).attr("y",function(a){return a.position.y+5}),c.enter().append("text").attr("x",function(a){return a.parent.position.x}).attr("y",function(a){return a.parent.position.y+5}).text(function(a){return a.labeltext}).transition().duration(500).attr("x",function(a){return a.position.x}).attr("y",function(a){return a.position.y+5}),c.exit().remove()},u=function(b,c,d){var e=d3.select("#g_circles").select("#name"+b),f=d+a;return e.transition().delay(d).style("stroke",c).style("stroke-width","4px").transition().duration(a-500).delay(f-500).style("stroke","grey").style("stroke-width","2px"),f},v=function(){e.root.left=g(),e.root.right=g(),k(e.root),s(),d3.select(".svg-container").append("svg").attr("width",b).attr("height",c).attr("id","treesvg");var a=d3.select("#treesvg").append("g").attr("id","g_lines").selectAll("line").data(r(),function(a){return a.childId});a.enter().append("line").attr("x1",function(a){return a.parentPosition.x}).attr("y1",function(a){return a.parentPosition.y}).attr("x2",function(a){return a.childPosition.x}).attr("y2",function(a){return a.childPosition.y});var f=d3.select("#treesvg").append("g").attr("id","g_circles").selectAll("circle").data(q(),function(a){return a.id});f.enter().append("circle").attr("id",function(a){return"name"+a.id}).attr("cx",function(a){return a.position.x}).attr("cy",function(a){return a.position.y}).attr("r",d);var h=d3.select("#treesvg").append("g").attr("id","g_labels").selectAll("text").data(q(),function(a){return a.id});h.enter().append("text").attr("x",function(a){return a.position.x}).attr("y",function(a){return a.position.y+5}).text(function(a){return a.labeltext}),e.addNewNode(7),e.addNewNode(5),e.addNewNode(3),e.addNewNode(6),e.addNewNode(12),e.addNewNode(10),e.addNewNode(4),e.addNewNode(11),s()};return v(),e}this.getRedBlackTree=function(){return a()}}),angular.module("visualApp").service("IrisDataService",function(){var a=[[["2","3","3","4","0","2"],"0"],[["1","0","3","6","2","1"],"2"],[["1","3","5","2","2","0"],"0"],[["3","0","5","6","1","2"],"1"],[["1","2","3","2","2","1"],"0"],[["3","0","3","2","1","1"],"0"],[["1","2","2","2","1","1"],"0"],[["0","0","3","2","0","0"],"0"],[["2","1","4","6","1","2"],"1"],[["1","0","2","2","2","2"],"0"],[["0","1","4","4","1","0"],"0"],[["1","3","5","6","2","1"],"1"],[["0","0","5","4","0","0"],"0"],[["2","0","5","2","1","0"],"0"],[["2","0","4","4","0","2"],"1"],[["2","3","5","2","1","2"],"0"],[["0","2","4","4","0","0"],"0"],[["0","0","3","6","2","0"],"0"],[["2","1","2","4","2","1"],"1"],[["0","3","2","4","0","1"],"0"],[["0","0","4","2","1","2"],"0"],[["2","1","5","6","1","2"],"1"],[["2","0","5","2","0","2"],"0"],[["2","2","3","2","2","0"],"0"],[["1","2","3","2","0","0"],"0"],[["0","2","5","4","0","2"],"1"],[["2","1","2","4","2","2"],"1"],[["2","1","5","4","2","1"],"1"],[["0","2","4","4","2","1"],"1"],[["2","1","5","4","1","0"],"0"],[["1","2","2","2","0","0"],"0"],[["2","1","2","2","1","1"],"0"],[["2","0","2","4","0","2"],"1"],[["1","2","4","4","2","1"],"1"],[["3","3","2","6","2","2"],"0"],[["0","1","2","6","0","0"],"0"],[["0","1","2","2","2","0"],"0"],[["2","3","5","2","0","0"],"0"],[["0","1","5","4","1","1"],"2"],[["0","3","3","4","0","0"],"0"],[["1","3","5","4","0","0"],"0"],[["1","1","5","6","0","0"],"0"],[["0","1","5","2","1","1"],"0"],[["1","2","5","2","0","0"],"0"],[["1","2","4","4","2","0"],"0"],[["1","3","2","4","0","1"],"0"],[["0","0","5","6","0","2"],"2"],[["0","2","5","6","2","0"],"0"],[["2","1","2","4","1","2"],"1"],[["1","0","4","4","0","0"],"0"],[["0","1","3","6","0","0"],"0"],[["1","3","2","6","0","2"],"0"],[["0","1","3","6","1","2"],"3"],[["0","3","3","6","1","2"],"1"],[["3","1","3","4","1","1"],"0"],[["2","0","5","2","2","1"],"0"],[["2","2","2","6","1","1"],"0"],[["1","2","5","2","1","2"],"0"],[["0","0","4","2","2","1"],"0"],[["1","0","5","4","1","2"],"3"],[["1","2","4","6","0","0"],"0"],[["1","0","3","2","2","2"],"0"],[["3","3","4","4","1","0"],"0"],[["0","0","2","6","0","1"],"0"],[["2","0","3","6","1","0"],"0"],[["2","0","4","4","2","2"],"1"],[["3","0","2","6","0","1"],"0"],[["2","0","4","4","1","2"],"1"],[["2","2","3","2","2","2"],"0"],[["3","3","3","4","2","0"],"0"],[["1","0","5","6","0","0"],"0"],[["1","1","4","2","0","0"],"0"],[["2","1","5","2","0","0"],"0"],[["0","1","3","6","2","1"],"2"],[["1","3","4","6","1","2"],"1"],[["3","0","3","6","0","0"],"0"],[["0","1","5","4","2","0"],"0"],[["3","3","2","6","0","1"],"0"],[["0","0","2","2","0","2"],"0"],[["2","0","2","6","0","0"],"0"],[["1","1","3","4","2","2"],"3"],[["2","2","3","4","1","0"],"0"],[["1","3","4","2","0","0"],"0"],[["3","0","3","4","2","1"],"1"],[["3","1","4","2","1","0"],"0"],[["0","2","3","2","2","0"],"0"],[["2","3","2","6","1","1"],"0"],[["1","3","3","4","1","0"],"0"],[["0","2","5","6","2","2"],"3"],[["2","0","3","6","0","1"],"0"],[["2","3","3","2","0","2"],"0"],[["2","3","2","6","2","0"],"0"],[["1","1","4","6","1","2"],"3"],[["3","3","5","6","0","1"],"0"],[["2","2","2","4","0","0"],"0"],[["2","3","4","2","0","0"],"0"],[["2","3","3","6","0","1"],"0"],[["0","0","2","6","2","0"],"0"],[["2","1","2","6","0","0"],"0"],[["2","3","5","4","1","2"],"0"],[["0","2","4","6","1","2"],"3"],[["3","2","2","6","1","0"],"0"],[["3","1","2","4","1","2"],"1"],[["3","2","5","4","1","1"],"0"],[["3","2","4","4","2","2"],"0"],[["2","1","5","6","0","1"],"0"],[["3","2","4","2","2","0"],"0"],[["1","3","2","4","2","2"],"1"],[["1","2","5","4","2","2"],"1"],[["1","3","2","6","1","2"],"1"],[["1","2","2","6","2","2"],"1"],[["0","1","3","4","1","0"],"0"],[["1","1","4","4","0","1"],"1"],[["2","3","3","2","0","0"],"0"],[["0","0","3","6","0","1"],"1"],[["2","3","3","6","1","1"],"0"],[["1","3","3","2","2","1"],"0"],[["3","1","4","6","0","0"],"0"],[["3","0","4","6","2","0"],"0"],[["0","1","4","6","2","1"],"2"],[["1","3","5","4","1","0"],"0"],[["0","0","2","2","1","1"],"0"],[["2","2","4","4","0","1"],"0"],[["1","2","5","2","0","2"],"0"],[["1","0","3","6","2","2"],"3"],[["0","1","4","2","1","0"],"0"],[["2","2","3","6","2","2"],"1"],[["2","0","5","6","2","0"],"0"],[["3","2","4","4","0","0"],"0"],[["3","3","5","4","1","2"],"0"],[["2","1","3","4","2","0"],"0"],[["0","3","4","6","0","2"],"1"],[["1","0","2","6","1","1"],"1"],[["2","3","3","4","2","1"],"0"],[["2","3","5","6","2","0"],"0"],[["1","2","5","4","2","1"],"1"],[["0","2","5","2","0","1"],"0"],[["3","0","3","6","1","1"],"1"],[["1","2","5","6","1","2"],"1"],[["0","2","4","6","2","1"],"1"],[["1","0","4","4","1","1"],"2"],[["1","1","2","6","2","2"],"3"],[["1","1","3","2","1","0"],"0"],[["2","0","2","2","0","0"],"0"],[["3","3","4","6","0","0"],"0"],[["1","1","4","4","1","1"],"1"],[["1","3","2","4","0","2"],"1"],[["3","1","5","2","1","2"],"0"],[["2","2","4","2","1","2"],"0"],[["3","2","5","4","0","2"],"0"],[["0","0","2","4","2","2"],"3"],[["1","2","3","4","2","0"],"0"],[["1","0","5","6","2","2"],"3"],[["0","3","5","4","2","2"],"1"],[["0","1","2","4","1","1"],"1"],[["3","1","4","2","2","1"],"0"],[["1","0","2","2","0","2"],"0"],[["0","2","4","2","2","0"],"0"],[["3","0","4","2","2","0"],"0"],[["3","3","2","2","0","2"],"0"],[["1","1","3","2","2","2"],"0"],[["1","3","5","6","1","2"],"1"],[["3","2","4","2","0","0"],"0"],[["0","3","5","4","1","2"],"1"],[["2","2","3","4","2","2"],"1"],[["1","1","5","2","1","0"],"0"],[["0","0","4","4","2","2"],"3"],[["1","0","2","6","2","2"],"3"],[["3","0","4","6","1","0"],"0"],[["3","3","5","4","0","0"],"0"],[["3","2","4","2","0","2"],"0"],[["2","2","2","2","0","1"],"0"],[["2","0","3","4","2","2"],"1"],[["3","0","3","4","1","0"],"0"],[["0","1","5","6","2","0"],"0"],[["1","0","5","4","0","1"],"1"],[["2","1","3","6","2","1"],"1"],[["3","0","4","2","0","2"],"0"],[["1","0","5","2","2","1"],"0"],[["2","0","5","2","2","2"],"0"],[["3","0","5","4","0","0"],"0"],[["0","2","2","2","2","2"],"0"],[["0","2","3","2","2","2"],"0"],[["3","0","2","2","1","1"],"0"],[["1","2","2","6","1","1"],"0"],[["0","2","2","2","0","1"],"0"],[["0","0","4","2","2","2"],"0"],[["0","2","3","4","2","0"],"0"],[["1","2","4","2","1","0"],"0"],[["3","3","2","4","0","1"],"0"],[["1","2","3","2","1","1"],"0"],[["3","0","3","2","2","1"],"0"],[["2","0","3","6","1","2"],"1"],[["0","2","4","2","0","2"],"0"],[["0","1","5","4","0","2"],"2"],[["1","0","3","6","0","0"],"0"],[["3","2","2","2","2","1"],"0"],[["3","3","4","2","0","1"],"0"],[["3","0","4","6","0","1"],"0"],[["0","3","4","2","0","2"],"0"],[["2","3","4","4","1","2"],"0"],[["3","2","3","4","2","0"],"0"],[["2","2","5","4","2","1"],"1"],[["3","2","3","6","1","1"],"0"],[["2","2","5","4","0","2"],"1"],[["1","2","3","2","2","0"],"0"],[["0","0","4","6","1","0"],"0"],[["3","2","2","4","2","2"],"0"],[["0","3","2","2","1","2"],"0"],[["3","1","5","4","0","1"],"0"],[["2","3","4","4","0","1"],"0"],[["1","3","3","6","2","2"],"1"],[["2","0","3","2","1","0"],"0"],[["3","0","4","6","0","0"],"0"],[["1","3","4","4","1","2"],"1"],[["3","0","2","2","2","0"],"0"],[["2","0","3","4","0","1"],"0"],[["1","3","3","6","0","0"],"0"],[["3","3","2","2","1","2"],"0"],[["1","1","4","2","0","1"],"0"],[["3","0","2","6","1","0"],"0"],[["0","3","4","2","1","0"],"0"],[["1","2","3","6","0","0"],"0"],[["2","0","2","2","1","2"],"0"],[["3","3","5","4","2","1"],"0"],[["1","1","3","4","2","0"],"0"],[["1","3","4","4","2","0"],"0"],[["1","1","5","2","2","0"],"0"],[["0","3","3","4","2","2"],"1"],[["2","0","2","4","1","0"],"0"],[["2","0","5","6","0","2"],"1"],[["0","1","5","2","0","1"],"0"],[["2","0","4","4","0","1"],"0"],[["2","1","5","2","1","0"],"0"],[["1","3","2","6","0","0"],"0"],[["1","3","3","2","2","0"],"0"],[["1","3","4","2","1","2"],"0"],[["0","1","3","4","0","0"],"0"],[["0","3","3","6","1","1"],"1"],[["1","0","2","2","1","1"],"0"],[["3","2","4","6","0","0"],"0"],[["0","3","4","4","1","1"],"1"],[["3","0","2","4","0","0"],"0"],[["0","1","3","2","0","0"],"0"],[["3","1","2","6","1","0"],"0"],[["2","0","3","2","0","2"],"0"],[["3","1","5","4","2","2"],"1"],[["1","2","5","4","0","0"],"0"],[["0","1","4","2","1","2"],"0"],[["0","2","2","6","1","0"],"0"],[["0","0","2","6","1","1"],"1"],[["2","3","2","2","0","1"],"0"],[["2","2","5","2","1","0"],"0"],[["0","3","2","4","0","2"],"1"],[["1","1","2","2","0","1"],"0"],[["3","3","2","2","2","1"],"0"],[["1","2","5","6","2","0"],"0"],[["1","0","2","4","1","2"],"2"],[["3","3","3","4","0","1"],"0"],[["0","1","5","2","1","0"],"0"],[["3","2","4","4","1","2"],"0"],[["2","3","3","4","0","0"],"0"],[["0","1","5","4","1","0"],"0"],[["2","3","3","6","0","2"],"0"],[["3","1","3","6","0","1"],"0"],[["0","2","4","2","1","0"],"0"],[["2","3","2","6","2","2"],"0"],[["0","2","3","6","2","0"],"0"],[["1","3","3","4","2","1"],"1"],[["1","2","5","6","0","1"],"0"],[["0","0","3","2","2","1"],"0"],[["2","2","3","2","1","1"],"0"],[["3","2","2","4","1","2"],"0"],[["0","2","5","6","1","0"],"0"],[["3","1","5","2","0","1"],"0"],[["1","3","2","4","1","1"],"0"],[["2","3","2","2","2","1"],"0"],[["1","3","5","4","1","2"],"1"],[["1","0","3","2","1","1"],"0"],[["3","0","3","4","2","2"],"1"],[["3","1","4","4","1","2"],"1"],[["2","2","5","4","2","0"],"0"],[["3","0","3","6","0","1"],"0"],[["3","1","5","2","1","1"],"0"],[["3","0","4","2","2","2"],"0"],[["3","1","3","4","0","1"],"0"],[["0","0","4","6","1","1"],"2"],[["1","3","5","2","1","1"],"0"],[["0","3","2","2","2","0"],"0"],[["0","3","5","2","2","2"],"0"],[["1","2","2","4","2","1"],"1"],[["3","1","4","2","2","0"],"0"],[["2","3","5","4","0","2"],"0"],[["3","1","4","2","2","2"],"0"],[["3","3","3","4","2","2"],"0"],[["1","0","4","4","2","0"],"0"],[["1","0","2","6","2","1"],"2"],[["1","0","3","6","2","0"],"0"],[["2","1","5","6","0","2"],"1"],[["1","1","2","2","1","1"],"0"],[["2","0","5","4","0","2"],"1"],[["1","0","4","6","1","0"],"0"],[["3","2","2","4","1","1"],"0"],[["2","3","2","4","1","0"],"0"],[["3","2","3","6","0","1"],"0"],[["1","3","2","4","2","1"],"1"],[["1","0","3","4","1","0"],"0"],[["3","3","4","4","2","2"],"0"],[["0","3","4","2","2","2"],"0"],[["0","3","3","4","1","0"],"0"],[["1","2","2","6","0","0"],"0"],[["0","3","5","4","1","1"],"1"],[["1","1","3","2","0","2"],"0"],[["0","2","5","6","0","0"],"0"],[["3","1","3","4","0","2"],"1"],[["2","3","4","4","2","0"],"0"],[["1","1","2","6","0","0"],"0"],[["1","3","5","2","2","1"],"0"],[["2","3","5","4","0","0"],"0"],[["0","3","2","4","0","0"],"0"],[["0","0","2","2","2","1"],"0"],[["1","2","3","6","0","2"],"1"],[["1","0","4","4","0","2"],"2"],[["2","2","3","4","2","0"],"0"],[["3","1","2","2","2","2"],"0"],[["3","1","4","6","2","0"],"0"],[["0","3","3","4","0","1"],"0"],[["0","1","5","6","1","0"],"0"],[["0","1","3","6","2","2"],"3"],[["0","3","5","4","1","0"],"0"],[["1","0","4","6","2","0"],"0"],[["2","1","4","2","2","0"],"0"],[["1","0","5","2","2","0"],"0"],[["0","3","4","6","0","0"],"0"],[["3","3","2","2","2","2"],"0"],[["2","2","2","2","1","0"],"0"],[["3","3","4","4","0","1"],"0"],[["1","2","4","6","1","0"],"0"],[["2","0","3","6","0","2"],"1"],[["1","2","4","4","1","1"],"1"],[["0","2","4","4","2","2"],"3"],[["3","0","5","4","0","1"],"0"],[["2","3","3","6","2","1"],"0"],[["1","1","2","2","1","0"],"0"],[["2","0","2","6","0","1"],"0"]];this.getIrisData=function(){return a}}),angular.module("visualApp").controller("NeuralCtrl",["$scope","NeuralNetService",function(a,b){b.getNeuralNet()}]),angular.module("visualApp").service("NeuralNetService",["IrisDataService",function(a){function b(){function b(a,b,c){var d=b.cx-a.cx,e=b.cy-a.cy,f=Math.sqrt(d*d+e*e),g=Math.atan2(e,d);f=f-i-3*c,d=f*Math.cos(g),e=f*Math.sin(g);var h={x:a.cx+d,y:a.cy+e};return h}function c(){s=[],t=[];for(var a=100,b=0;a>b;b++){var c=b/a*5+convnetjs.randf(-.1,.1),d=1.25*b/a*2*Math.PI+convnetjs.randf(-.1,.1);s.push([c*Math.sin(d),c*Math.cos(d)]),t.push(1)}for(var b=0;a>b;b++){var c=b/a*5+convnetjs.randf(-.1,.1),d=1.25*b/a*2*Math.PI+Math.PI+convnetjs.randf(-.1,.1);s.push([c*Math.sin(d),c*Math.cos(d)]),t.push(0)}}function d(){function a(a){return a[0].map(function(b,c){return a.map(function(a){return a[c]})})}function c(a){return Math.max.apply(Math,a.map(function(a){return Math.max.apply(null,a)}))}function d(a){return Math.min.apply(Math,a.map(function(a){return Math.min.apply(null,a)}))}function e(a){var b=d(a),e=c(a);return a.map(function(a){return a.map(function(a){return(a+-1*b)*(10/(e-b))+1})})}function g(a){for(var b=[],c=f.layers[a],d=new convnetjs.Vol(1,1,c.out_depth,0),e=c.in_act.w,g=0;g<c.out_depth;g++){for(var h=[],i=0,j=c.filters[g].w,k=0;k<c.num_inputs;k++)i+=e[k]*j[k],h.push(e[k]*j[k]);i+=c.biases.w[g],d.w[g]=i,b.push(h)}return b}var h=(d3.select("#treesvg"),{inputs:e(a(g(1))),midNodes0:e(a(g(3))),midNodes1:e(a(g(5)))}),i=d3.select("#arrow_lines").selectAll("line");i.attr("stroke-width",function(a){var b=a.id.split(" "),c=h[b[0]],d=c[parseInt(b[1])][parseInt(b[2])],e=d.toString();return a.strokeWidth=parseFloat(e),e}).attr("x2",function(a){return b(a.parent,a.child,a.strokeWidth).x}).attr("y2",function(a){return b(a.parent,a.child,a.strokeWidth).y})}function e(){function b(a){console.log("running");for(var b=0;200>b;b++)j.w=s[b],h=t[b],i.train(j,h);a%10==0&&d()}var c=new convnetjs.Vol([-2.7647368600411255,1.8821490267965022]),e=f.forward(c);console.log(e);var g,h,h,i=new convnetjs.SGDTrainer(f,{learning_rate:.01,momentum:.1,batch_size:10,l2_decay:.001}),j=(a.getIrisData(),new convnetjs.Vol(1,1,2));!function k(a){setTimeout(function(){b(a),--a&&k(a)},10)}(1e3),setTimeout(function(){g=f.forward(c),console.log(g)},25e3)}var f,g=d3.select(".svg-container").node().getBoundingClientRect().width,h=700,i=30,j=2,k=6,l=2,m=2,n=[],o=[],p=[],q=[],r=[],s=[],t=[],u=function(){var a=function(a,b,c){for(var d=120,e=2*i+d,f=i*a*2+d*(a-1),h=[],j=g/2-f/2+i,k=0;a>k;k++){var l=Math.floor(j+k*e);h.push({cx:l,cy:b,w:i,h:i,id:c+" "+k.toString()})}return h};n=a(j,60,"inputs"),o=a(k,200,"midNodes0"),p=a(l,340,"midNodes1"),q=a(m,480,"outputs")},v=function(){var a=function(a,c){var d=[];return angular.forEach(a,function(a){angular.forEach(c,function(c){d.push({parentPosition:{x:a.cx,y:a.cy},childPosition:b(a,c,3),id:a.id+" "+c.id.split(" ")[1],parent:a,child:c})})}),d},c=a(n,o),d=a(o,p),e=a(p,q);r=c.concat(d).concat(e)},w=function(){return r},x=function(){var a=n.concat(o).concat(p).concat(q);return a},y=function(){c();var a=[];a.push({type:"input",out_sx:1,out_sy:1,out_depth:2}),a.push({type:"fc",num_neurons:6,activation:"tanh"}),a.push({type:"fc",num_neurons:2,activation:"tanh"}),a.push({type:"softmax",num_classes:2}),f=new convnetjs.Net,f.makeLayers(a),u(),v(),d3.select(".svg-container").append("svg").attr("width",g).attr("height",h).attr("id","treesvg"),d3.select("#treesvg").append("marker").attr("id","triangle").attr("viewBox","0 0 10 10").attr("refX","0").attr("refY","5").attr("markerUnits","strokeWidth").attr("markerWidth","4").attr("markerHeight","3").attr("orient","auto").append("svg:path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("fill","context-stroke");var b=d3.select("#treesvg").append("g").attr("id","arrow_lines").selectAll("line").data(w(),function(a){return a.id});b.enter().append("line").attr("x1",function(a){return a.parentPosition.x}).attr("y1",function(a){return a.parentPosition.y}).attr("x2",function(a){return a.childPosition.x}).attr("y2",function(a){return a.childPosition.y}).attr("class","cat").attr("marker-end","url(#triangle)");var d=(d3.select("#treesvg"),d3.select("#treesvg").append("g").attr("id","circles").selectAll("circle").data(x(),function(a){return a.id}));d.enter().append("circle").attr("id",function(a){return"name"+a.id}).attr("cx",function(a){return a.cx}).attr("cy",function(a){return a.cy}).attr("r",i);var j=d3.select("#treesvg").append("g").attr("id","g_labels").selectAll("text").data(x(),function(a){return a.id});j.enter().append("text").attr("x",function(){return 0}).attr("y",function(){return 0}).text(function(){return""}),e()};y()}this.getNeuralNet=function(){return b()}}]),angular.module("visualApp").service("iris",function(){var a=[[5.1,3.5,1.4,.2,"Iris-setosa"],[4.9,3,1.4,.2,"Iris-setosa"],[4.7,3.2,1.3,.2,"Iris-setosa"],[4.6,3.1,1.5,.2,"Iris-setosa"],[5,3.6,1.4,.2,"Iris-setosa"],[5.4,3.9,1.7,.4,"Iris-setosa"],[4.6,3.4,1.4,.3,"Iris-setosa"],[5,3.4,1.5,.2,"Iris-setosa"],[4.4,2.9,1.4,.2,"Iris-setosa"],[4.9,3.1,1.5,.1,"Iris-setosa"],[5.4,3.7,1.5,.2,"Iris-setosa"],[4.8,3.4,1.6,.2,"Iris-setosa"],[4.8,3,1.4,.1,"Iris-setosa"],[4.3,3,1.1,.1,"Iris-setosa"],[5.8,4,1.2,.2,"Iris-setosa"],[5.7,4.4,1.5,.4,"Iris-setosa"],[5.4,3.9,1.3,.4,"Iris-setosa"],[5.1,3.5,1.4,.3,"Iris-setosa"],[5.7,3.8,1.7,.3,"Iris-setosa"],[5.1,3.8,1.5,.3,"Iris-setosa"],[5.4,3.4,1.7,.2,"Iris-setosa"],[5.1,3.7,1.5,.4,"Iris-setosa"],[4.6,3.6,1,.2,"Iris-setosa"],[5.1,3.3,1.7,.5,"Iris-setosa"],[4.8,3.4,1.9,.2,"Iris-setosa"],[5,3,1.6,.2,"Iris-setosa"],[5,3.4,1.6,.4,"Iris-setosa"],[5.2,3.5,1.5,.2,"Iris-setosa"],[5.2,3.4,1.4,.2,"Iris-setosa"],[4.7,3.2,1.6,.2,"Iris-setosa"],[4.8,3.1,1.6,.2,"Iris-setosa"],[5.4,3.4,1.5,.4,"Iris-setosa"],[5.2,4.1,1.5,.1,"Iris-setosa"],[5.5,4.2,1.4,.2,"Iris-setosa"],[4.9,3.1,1.5,.1,"Iris-setosa"],[5,3.2,1.2,.2,"Iris-setosa"],[5.5,3.5,1.3,.2,"Iris-setosa"],[4.9,3.1,1.5,.1,"Iris-setosa"],[4.4,3,1.3,.2,"Iris-setosa"],[5.1,3.4,1.5,.2,"Iris-setosa"],[5,3.5,1.3,.3,"Iris-setosa"],[4.5,2.3,1.3,.3,"Iris-setosa"],[4.4,3.2,1.3,.2,"Iris-setosa"],[5,3.5,1.6,.6,"Iris-setosa"],[5.1,3.8,1.9,.4,"Iris-setosa"],[4.8,3,1.4,.3,"Iris-setosa"],[5.1,3.8,1.6,.2,"Iris-setosa"],[4.6,3.2,1.4,.2,"Iris-setosa"],[5.3,3.7,1.5,.2,"Iris-setosa"],[5,3.3,1.4,.2,"Iris-setosa"],[7,3.2,4.7,1.4,"Iris-versicolor"],[6.4,3.2,4.5,1.5,"Iris-versicolor"],[6.9,3.1,4.9,1.5,"Iris-versicolor"],[5.5,2.3,4,1.3,"Iris-versicolor"],[6.5,2.8,4.6,1.5,"Iris-versicolor"],[5.7,2.8,4.5,1.3,"Iris-versicolor"],[6.3,3.3,4.7,1.6,"Iris-versicolor"],[4.9,2.4,3.3,1,"Iris-versicolor"],[6.6,2.9,4.6,1.3,"Iris-versicolor"],[5.2,2.7,3.9,1.4,"Iris-versicolor"],[5,2,3.5,1,"Iris-versicolor"],[5.9,3,4.2,1.5,"Iris-versicolor"],[6,2.2,4,1,"Iris-versicolor"],[6.1,2.9,4.7,1.4,"Iris-versicolor"],[5.6,2.9,3.6,1.3,"Iris-versicolor"],[6.7,3.1,4.4,1.4,"Iris-versicolor"],[5.6,3,4.5,1.5,"Iris-versicolor"],[5.8,2.7,4.1,1,"Iris-versicolor"],[6.2,2.2,4.5,1.5,"Iris-versicolor"],[5.6,2.5,3.9,1.1,"Iris-versicolor"],[5.9,3.2,4.8,1.8,"Iris-versicolor"],[6.1,2.8,4,1.3,"Iris-versicolor"],[6.3,2.5,4.9,1.5,"Iris-versicolor"],[6.1,2.8,4.7,1.2,"Iris-versicolor"],[6.4,2.9,4.3,1.3,"Iris-versicolor"],[6.6,3,4.4,1.4,"Iris-versicolor"],[6.8,2.8,4.8,1.4,"Iris-versicolor"],[6.7,3,5,1.7,"Iris-versicolor"],[6,2.9,4.5,1.5,"Iris-versicolor"],[5.7,2.6,3.5,1,"Iris-versicolor"],[5.5,2.4,3.8,1.1,"Iris-versicolor"],[5.5,2.4,3.7,1,"Iris-versicolor"],[5.8,2.7,3.9,1.2,"Iris-versicolor"],[6,2.7,5.1,1.6,"Iris-versicolor"],[5.4,3,4.5,1.5,"Iris-versicolor"],[6,3.4,4.5,1.6,"Iris-versicolor"],[6.7,3.1,4.7,1.5,"Iris-versicolor"],[6.3,2.3,4.4,1.3,"Iris-versicolor"],[5.6,3,4.1,1.3,"Iris-versicolor"],[5.5,2.5,4,1.3,"Iris-versicolor"],[5.5,2.6,4.4,1.2,"Iris-versicolor"],[6.1,3,4.6,1.4,"Iris-versicolor"],[5.8,2.6,4,1.2,"Iris-versicolor"],[5,2.3,3.3,1,"Iris-versicolor"],[5.6,2.7,4.2,1.3,"Iris-versicolor"],[5.7,3,4.2,1.2,"Iris-versicolor"],[5.7,2.9,4.2,1.3,"Iris-versicolor"],[6.2,2.9,4.3,1.3,"Iris-versicolor"],[5.1,2.5,3,1.1,"Iris-versicolor"],[5.7,2.8,4.1,1.3,"Iris-versicolor"],[6.3,3.3,6,2.5,"Iris-virginica"],[5.8,2.7,5.1,1.9,"Iris-virginica"],[7.1,3,5.9,2.1,"Iris-virginica"],[6.3,2.9,5.6,1.8,"Iris-virginica"],[6.5,3,5.8,2.2,"Iris-virginica"],[7.6,3,6.6,2.1,"Iris-virginica"],[4.9,2.5,4.5,1.7,"Iris-virginica"],[7.3,2.9,6.3,1.8,"Iris-virginica"],[6.7,2.5,5.8,1.8,"Iris-virginica"],[7.2,3.6,6.1,2.5,"Iris-virginica"],[6.5,3.2,5.1,2,"Iris-virginica"],[6.4,2.7,5.3,1.9,"Iris-virginica"],[6.8,3,5.5,2.1,"Iris-virginica"],[5.7,2.5,5,2,"Iris-virginica"],[5.8,2.8,5.1,2.4,"Iris-virginica"],[6.4,3.2,5.3,2.3,"Iris-virginica"],[6.5,3,5.5,1.8,"Iris-virginica"],[7.7,3.8,6.7,2.2,"Iris-virginica"],[7.7,2.6,6.9,2.3,"Iris-virginica"],[6,2.2,5,1.5,"Iris-virginica"],[6.9,3.2,5.7,2.3,"Iris-virginica"],[5.6,2.8,4.9,2,"Iris-virginica"],[7.7,2.8,6.7,2,"Iris-virginica"],[6.3,2.7,4.9,1.8,"Iris-virginica"],[6.7,3.3,5.7,2.1,"Iris-virginica"],[7.2,3.2,6,1.8,"Iris-virginica"],[6.2,2.8,4.8,1.8,"Iris-virginica"],[6.1,3,4.9,1.8,"Iris-virginica"],[6.4,2.8,5.6,2.1,"Iris-virginica"],[7.2,3,5.8,1.6,"Iris-virginica"],[7.4,2.8,6.1,1.9,"Iris-virginica"],[7.9,3.8,6.4,2,"Iris-virginica"],[6.4,2.8,5.6,2.2,"Iris-virginica"],[6.3,2.8,5.1,1.5,"Iris-virginica"],[6.1,2.6,5.6,1.4,"Iris-virginica"],[7.7,3,6.1,2.3,"Iris-virginica"],[6.3,3.4,5.6,2.4,"Iris-virginica"],[6.4,3.1,5.5,1.8,"Iris-virginica"],[6,3,4.8,1.8,"Iris-virginica"],[6.9,3.1,5.4,2.1,"Iris-virginica"],[6.7,3.1,5.6,2.4,"Iris-virginica"],[6.9,3.1,5.1,2.3,"Iris-virginica"],[5.8,2.7,5.1,1.9,"Iris-virginica"],[6.8,3.2,5.9,2.3,"Iris-virginica"],[6.7,3.3,5.7,2.5,"Iris-virginica"],[6.7,3,5.2,2.3,"Iris-virginica"],[6.3,2.5,5,1.9,"Iris-virginica"],[6.5,3,5.2,2,"Iris-virginica"],[6.2,3.4,5.4,2.3,"Iris-virginica"],[5.9,3,5.1,1.8,"Iris-virginica"]];
this.getIrisData=function(){return a}});